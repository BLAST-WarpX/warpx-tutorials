---
title: 'A Beam-Beam Collision'
teaching: 10
exercises: 20
---

:::::::::::::::::::::::::::::::::::::: questions 

How to use WarpX for beam-beam simulations of colliders üí•?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

Learn how to setup, run, and visualize your own beam-beam ‚òÑÔ∏è‚òÑÔ∏è simulation

::::::::::::::::::::::::::::::::::::::::::::::::

![A snapshot of a beam-beam simulation.](https://gist.github.com/user-attachments/assets/217dfcde-8a77-4f73-b4bb-26c83e921255){alt="snapshot of a beam-beam simulation"}


## Setup

In this example we will simulate a bunch of electrons colliding against a bunch of positrons.
We have selected the parameters of the C$^3$ linear collider, arbitrarily. 

Whenever you need to prepare an input file, [this is where you want to go](https://warpx.readthedocs.io/en/latest/usage/parameters.html).

:::::::::::::::::::::::::::::::::::::::::: spoiler

### Let's take a look at the input file

```{r engine='bash', echo=FALSE, comment=''}
cat ./files/inputs_3d_beambeam_C3.txt
```
::::::::::::::::::::::::::::::::::::::::::::::::::


Some notable details:

*  Poisson solver: because the beams are ultra-relativistic (125 GeV electrons and positrons) and flat, 
we use an FFT-based electrostatic solver. 
Specifically, it solves many 2D Poisson equations in the $(x,y)$ plane for each $z$.
The full 3D version of this solver is also available with `warpx.use_2d_slices_fft_solver = 0`. 

*  Resolution: the number of grid cells is reduced to fit in a laptop. For production simulations, make sure you increase the resolution.

*  Timestep: since the beams travel at the speed of light along $z$, it makes sense to choose $dt = 
However this is not strictly necessary. Sometimes it can be useful to save resources by choosing a larger timestep.
Just make sure you resolve ''well-enough'' the shortest timescale that you're interested in. 

*  QED lookup tables: here we use the built-in ones for convenience. For production runs, make sure to use tables with enough points and set the 
ranges of the $\chi$ parameter to what you need. 

*  Diagnostics:
    * the trajectories of the beam particles. This diagnostic can easily take up too much memory. 
    For simulations with many macroparticles, consider using a field diagnostic. 
    * all the particles that exit the domain (`BoundaryScraping`)
    * the differential luminosity of every pair of left-ward and right-ward moving species 
    

## Run 

The optimal way to run the simulation depends on your hardware. 

::: challenge

I have used this setup on my laptop and the simulation took ~44 seconds.

```bash
export OMP_NUM_THREADS=2
mpirun -np 4 warpx.3d inputs_3d_beambeam_C3.txt 
```

:::


## Visualize

### With Python üêç

Now that we have the results, we can analyze them using Python.  
We will use the [openPMD-viewer][openpmd-viewer] library to grab the data that the simulation produced in `openPMD` format. 
Here you can find [a few great tutorials on how to use the viewer](https://openpmd-viewer.readthedocs.io/en/latest/tutorials/tutorials.html).
If you feel nerdy and/or you need to deal with the data in parallel workflows, you can use the [openPMD-api][openpmd-api].

As an example for the magnetic bottle simulation, we have developed simple Jupyter notebook where we retrieve the magnetic field 
and the particle attributes at the end of the simulation.
With a little bit more work, we also plot the trajectories of the particles.

:::::::::::::::::::::::::::::::::::::::::: spoiler

## Let's take a look at the Jupyter notebook

```{r, results='asis', echo=FALSE}
cat('<iframe src="https://nbviewer.org/github/BLAST-WarpX/warpx-tutorials/blob/main/episodes/files/analysis_3d_beambeam.ipynb" 
           width="100%" height="800" style="border:none;">
     </iframe>')
```
::::::::::::::::::::::::::::::::::::::::::::::::::


### With Paraview

::: caution

Coming soon!
:::


::::::::::::::::::::::::::::::::::::: keypoints 

 üíÖ There are several details one needs to take care when setting up a beam-beam simulation

 üîç The [**documentation**][warpx-readthedocs] is the first place to look for answers, 
 otherwise check out our [**issues**][warpx-issues] and [**discussions**][warpx-discussions] and ask there.  

 üì∑ To analyze and visualize the simulation results in [**openPMD**][openpmd] format, 
 you can use the [**openPMD-viewer**][openpmd-viewer] library for Python.

::::::::::::::::::::::::::::::::::::::::::::::::
